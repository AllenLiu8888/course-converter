# 课程转换器项目实施指南 (Minimal Workflow)

## 项目概述

本项目是一个使用函数式JavaScript开发的命令行工具，用于将OpenEdx OLX格式的课程包转换为LiaScript格式。项目采用函数式编程范式，支持批量处理，并具有完整的错误处理和测试覆盖。

## 🏆 Minimal Workflow (满分保证路径)

基于评分标准优化的7个Epic开发流程，确保高效完成所有必需功能。

## Epic 1: Project Setup & Planning

### 任务1.1: 编写Planning.md文档 🚀 参考 Group Planning Session
- [ ] 创建Planning.md包含以下8个部分：
  - 输入/输出规范
  - 内容映射表 (OLX → LiaScript)
  - 转换管道流程
  - 数据模型设计
  - 函数式编程方法
  - 错误处理策略  
  - 测试计划
  - 文档和提交要求

### 任务1.2: 初始化Node项目 🚀 参考 Set-up the Project
- [ ] 运行 `npm init -y` 初始化项目
- [ ] 安装依赖包：
  ```bash
  npm install tar fast-xml-parser node-html-markdown
  npm install --save-dev jest
  ```
- [ ] 配置package.json的scripts：
  ```json
  "scripts": {
    "test": "jest",
    "test:coverage": "jest --coverage"
  }
  ```
- [ ] 添加 `"type": "module"` 支持ES模块
- [ ] 创建jest.config.js配置文件

### 任务1.3: 创建项目结构 🚀 参考 Set-up the Project 目录结构
- [ ] 创建以下目录结构：
  ```
  ├── src/
  │   ├── core/           # 核心解析和标准化
  │   └── handlers/       # 内容处理器
  ├── tests/              # 测试文件
  ├── inputcourses/       # 输入测试数据
  └── outputcourses/      # 输出目录
  ```
- [ ] 创建主入口文件 `courseconverter.js`

---

## Epic 2: Core Parsing & Normalization

### 任务2.1: 实现collectInputs函数 🚀 参考 Validate Command-Line Arguments
- [ ] 接受单个.tar.gz文件或输入目录
- [ ] 扫描目录中的所有.tar.gz文件
- [ ] 验证输入文件存在性
- [ ] 返回待处理文件列表

### 任务2.2: 实现extractTarGz函数 🚀 参考 Guard Functions + CLI Driver 解压部分
- [ ] 使用tar库解压.tar.gz文件
- [ ] 创建临时解压目录
- [ ] 验证解压后的课程结构
- [ ] 返回解压后的课程目录路径

### 任务2.3: 实现parseOlx函数 🚀 参考 XML Parser & Reader + Build the Org Tree
- [ ] 读取course.xml获取课程代码
- [ ] 解析课程层级结构XML
- [ ] 递归读取chapter, sequential, vertical XML文件
- [ ] 解析各类型组件XML (html, video, problem等)
- [ ] 构建原始课程数据树

### 任务2.4: 实现normalize函数 🚀 参考 Build the Org Tree 数据标准化部分
- [ ] 构建统一的课程树结构
- [ ] 展平vertical节点，将内容直接放在sequential下
- [ ] 过滤未发布的内容 (published=false)
- [ ] 标准化字符串和数据格式
- [ ] 返回不可变的标准化课程对象

---

## Epic 3: Content Handlers Implementation

### 任务3.1: Handler – 标题处理
- [ ] 实现课程标题 → `# Level 1 Heading`
- [ ] 实现章节标题 → `## Level 2 Heading`  
- [ ] 实现小节标题 → `### Level 3 Heading`
- [ ] 确保标题层级正确嵌套

### 任务3.2: Handler – HTML转Markdown
- [ ] 使用node-html-markdown转换HTML
- [ ] 将h1-h3标签转换为粗体格式
- [ ] 更新图片路径指向media/目录
- [ ] 清理HTML中的脚本和样式标签
- [ ] 处理特殊字符和实体编码

### 任务3.3: Handler – 视频处理
- [ ] 检测YouTube视频链接
- [ ] 转换为LiaScript视频格式: `!?[title](url)`
- [ ] 处理非YouTube视频（生成占位符）
- [ ] 验证视频URL有效性

### 任务3.4: Handler – About页面
- [ ] 创建`## About`章节
- [ ] 将About页面HTML转换为Markdown
- [ ] 处理About页面中的图片和链接
- [ ] 放置在课程末尾

### 任务3.5: Handler – 问题类型
- [ ] **MCQ (单选题)**: `(X)` 正确答案, `( )` 错误答案
- [ ] **Checkbox (多选题)**: `[X]` 选中, `[ ]` 未选中
- [ ] **Dropdown (下拉)**: `[[option1|option2|option3]]`
- [ ] **Text (文本输入)**: `[[input]]`
- [ ] **Numeric (数值输入)**: `[[number]]`
- [ ] **Hint (提示)**: 添加到问题下方

### 任务3.6: Handler – 不支持内容
- [ ] 为不支持的组件插入占位符：
  ```markdown
  > **Unsupported content: ComponentName component omitted**
  ```
- [ ] 记录组件类型和名称
- [ ] 提供用户友好的说明

---

## Epic 4: Rendering & Media Handling

### 任务4.1: 实现renderMarkdown函数 🚀 参考 Markdown Renderer
- [ ] 组合章节、小节和内容为完整Markdown
- [ ] 按正确层级组织标题结构
- [ ] 在文档末尾添加About章节
- [ ] 确保Markdown语法正确
- [ ] 清理多余空行和格式问题

### 任务4.2: 实现rewriteAndCopyMedia函数 🚀 参考 CLI Driver 文件处理部分
- [ ] 扫描内容中的媒体引用（图片、文档等）
- [ ] 复制媒体文件到output/media/目录
- [ ] 重写内容中的媒体路径指向./media/
- [ ] 处理缺失媒体文件（警告但不停止转换）
- [ ] 支持常见媒体格式 (jpg, png, pdf等)

### 任务4.3: 实现writeOutputs函数 🚀 参考 CLI Driver 输出文件写入
- [ ] 创建outputcourses/<course-code>/目录
- [ ] 写入course.md文件
- [ ] 创建media/子目录
- [ ] 设置正确的文件权限
- [ ] 验证输出文件完整性

---

## Epic 5: Batch Processing & Error Handling

### 任务5.1: 批量处理 – 多课程循环 🚀 参考 CLI Driver 主流程
- [ ] 遍历所有输入.tar.gz文件
- [ ] 为每个课程创建独立的处理流程
- [ ] 并行处理多个课程（可选优化）
- [ ] 显示处理进度和统计信息

### 任务5.2: 错误隔离 – 单个失败不影响其他 🚀 参考 Result Helpers (Ok/Err 模式)
- [ ] 为每个课程使用try-catch包装
- [ ] 记录失败的课程和错误原因
- [ ] 继续处理剩余课程
- [ ] 在最后汇总所有成功和失败情况

### 任务5.3: 用户友好错误信息 🚀 参考 Guard Functions 错误处理
- [ ] **缺失XML文件**: "无法找到course.xml"
- [ ] **资源文件缺失**: "警告：图片xxx.png未找到"
- [ ] **非YouTube视频**: "不支持的视频格式，已创建占位符"
- [ ] **格式错误**: "XML解析失败：格式错误"
- [ ] 提供建议的解决方案

---

## Epic 6: Testing (Jest)

### 任务6.1: 单元测试 – normalize & handlers
- [ ] 测试normalize函数：vertical展平、未发布内容过滤
- [ ] 测试HTML handler：转Markdown、h1-h3转粗体
- [ ] 测试Video handler：YouTube检测、LiaScript格式
- [ ] 测试Problems handlers：所有5种问题类型
- [ ] 测试About handler：HTML转Markdown

### 任务6.2: 集成测试 – Simple课程
- [ ] 准备简单测试课程（基本HTML、视频、1个MCQ）
- [ ] 测试完整转换流程
- [ ] 验证输出目录结构
- [ ] 检查course.md内容正确性

### 任务6.3: 集成测试 – Intermediate课程
- [ ] 准备复杂测试课程（所有内容类型、媒体文件）
- [ ] 测试所有处理器功能
- [ ] 验证媒体文件复制和路径重写
- [ ] 检查About页面处理

### 任务6.4: 批量测试 – 多课程包含一个失败
- [ ] 准备多个课程包，其中一个故意损坏
- [ ] 验证错误隔离机制工作
- [ ] 检查其他课程正常处理
- [ ] 验证错误报告准确性

### 任务6.5: 快照测试 – course.md结构
- [ ] 为标准输出创建Jest快照
- [ ] 确保输出格式稳定性
- [ ] 检测意外的输出变化

---

## Epic 7: Documentation & Submission

### 任务7.1: 编写README.md 🚀 参考 Run and Verify 运行验证部分
- [ ] **应用描述**: 项目功能和用途
- [ ] **运行说明**: 安装依赖、使用命令
- [ ] **测试说明**: 如何运行测试
- [ ] **AI使用声明**: 说明AI辅助的部分
- [ ] **参考资料**: 引用的库和教程

### 任务7.2: 添加JSDoc注释 🚀 参考 Importing Packages 注释风格
- [ ] 为所有主要函数添加@param和@returns
- [ ] 描述函数用途和逻辑
- [ ] 包含使用示例
- [ ] 说明错误处理方式

### 任务7.3: 打包提交 🚀 参考 Complete Reference 完整代码检查
- [ ] 创建提交包：`studentID_Firstname_Lastname_FunctionalJS.zip`
- [ ] 包含源代码、README.md、Planning Document
- [ ] 包含测试文件和测试数据
- [ ] 排除node_modules等不必要文件

### 任务7.4: 最终自检 🚀 参考 Run and Verify 最终验证
- [ ] **评分标准对照**:
  - ✅ Attention to Detail (15%): Planning、结构、运行
  - ✅ Core Functionality (40%): 所有内容类型转换
  - ✅ Code Style & Testing (20%): JSDoc、Jest、错误处理
  - ✅ FP Paradigm (25%): 函数式风格、不可变数据
- [ ] 运行完整测试套件确保通过
- [ ] 检查文档完整性

---

## 🎯 为什么这是最小且充分的方案

### ✅ **无多余步骤**
- 移除了非必需功能（如转换报告conversion-report.json）
- 专注评分标准要求的核心功能
- 避免过度工程化

### ✅ **覆盖所有必需要求**
- 内容映射：所有必需的内容类型转换
- 批量转换：支持单文件和目录处理
- 错误隔离：单个失败不影响其他课程
- 测试：单元、集成、快照测试
- 函数式风格：纯函数、不可变数据、模块化处理器
- 文档：Planning文档、README、JSDoc注释

### ✅ **直接对应评分标准**
- **Attention to Detail (15%)** → Epic 1: Planning + 项目结构
- **Core Functionality (40%)** → Epic 2-4: 解析、处理器、渲染
- **Code Style & Testing (20%)** → Epic 6-7: JSDoc、Jest、错误处理
- **FP Paradigm (25%)** → 整体设计：函数式风格、不可变性、模块化

## 📝 **实施建议**

### 🚀 **高效开发路径**
1. **Epic 1**: 基础搭建（1天）
2. **Epic 2-3**: 核心功能（3-4天）
3. **Epic 4-5**: 输出和批处理（2天）
4. **Epic 6-7**: 测试和文档（2天）

**总计：7-9天** - 比原方案缩短40%时间

### 🎯 **关键成功要素**
- **函数式编程**: map/filter/reduce，纯函数，不可变数据
- **错误隔离**: try-catch每个课程，友好错误信息
- **测试驱动**: 边写边测，确保功能正确
- **模块化**: 处理器注册表，可扩展架构

### ⚡ **效率提升技巧**
- 先实现基本功能，再优化细节
- 复用现有的库和工具
- 并行开发不相关的模块
- 用测试验证每个功能点

### 📚 **参考项目对照表**

| 课程转换器组件 | 🚀 Org-Chart Parser 对应部分 | 核心概念 |
|---------------|---------------------------|---------|
| CLI入口参数验证 | Validate Command-Line Arguments | 参数检查 |
| tar.gz解压 | CLI Driver 解压部分 | 文件处理 |
| XML解析 | XML Parser & Reader | XML→JS对象 |
| 课程树构建 | Build the Org Tree | 递归遍历 |
| 数据标准化 | Build the Org Tree 数据处理 | 函数式转换 |
| Markdown渲染 | Markdown Renderer | 层级输出 |
| 错误处理 | Result Helpers (Ok/Err) | 优雅失败 |
| 批量处理 | CLI Driver 主流程 | 流程控制 |

这个Minimal Workflow确保你在最短时间内完成所有评分要求，获得满分！🏆